<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Peak - تسجيل الدخول والبحث العقاري</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Tajawal', sans-serif; background: #f4f4f4; margin: 0; padding: 0; }
    .container { max-width: 400px; margin: 30px auto; padding: 20px; background: #fff; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    h2, h3 { text-align: center; color: #333; }
    input, select, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; }
    button { width: 100%; padding: 12px; background: #007bff; color: white; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; margin-top: 10px; }
    button:hover { background: #0056b3; }
    #form-section, #orders-section { display: none; }
    #status { color: green; text-align: center; margin-top: 10px; }
    #orders-list div { border: 1px solid #ccc; padding: 10px; margin-bottom: 8px; border-radius: 6px; background: #fafafa; }
  </style>
</head>
<body>

<!-- ✅ Login Section -->
<div class="container" id="login-section">
  <h2>تسجيل الدخول برقم الهاتف</h2>
  <input type="text" id="phoneNumber" placeholder="+201234567890">
  <div id="recaptcha-container"></div>
  <button onclick="sendOTP()">إرسال رمز التحقق</button>
  <input type="text" id="otpCode" placeholder="أدخل الكود">
  <button onclick="verifyOTP()">تأكيد الكود</button>
  <p id="status"></p>
</div>

<!-- ✅ Form Section -->
<div class="container" id="form-section">
  <h2>أدخل بيانات طلبك العقاري</h2>
  <form id="requestForm">
    <input type="text" name="location" placeholder="الموقع" required>
    <select name="propertyType">
      <option value="شقة">شقة</option>
      <option value="فيلا">فيلا</option>
      <option value="أرض">أرض</option>
    </select>
    <input type="number" name="priceMin" placeholder="الحد الأدنى للسعر">
    <input type="number" name="priceMax" placeholder="الحد الأعلى للسعر">
    <input type="number" name="size" placeholder="المساحة (متر مربع)">
    <textarea name="notes" placeholder="ملاحظات إضافية"></textarea>
    <button type="submit">إرسال الطلب</button>
  </form>
  <p id="form-status"></p>
</div>

<!-- ✅ Orders Section -->
<div class="container" id="orders-section">
  <h3>طلباتي</h3>
  <button onclick="loadOrders()">عرض طلباتي</button>
  <div id="orders-list"><p>لا توجد طلبات حتى الآن</p></div>
</div>

<!-- ✅ Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCei58_3JhvjAMDKFQgHvV4BY7jsqX85mA",
    authDomain: "peak-694bd.firebaseapp.com",
    projectId: "peak-694bd",
    storageBucket: "peak-694bd.firebasestorage.app",
    messagingSenderId: "26071109649",
    appId: "1:26071109649:web:20ea3e12e14e9cc820a1b0",
    measurementId: "G-JC9MLS2N6M"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
    size: 'normal'
  });

  let userPhone = "";
  const scriptURL = "https://script.google.com/macros/s/AKfycbyfA4PqeAos3Oai43RhK8hoqUDA8YJ9k1hZJOvXGw2phLLj2u-Um9cqKicN60aYbps-/exec"; // ضع رابط السكربت هنا

  function sendOTP() {
    const phoneNumber = document.getElementById('phoneNumber').value;
    auth.signInWithPhoneNumber(phoneNumber, window.recaptchaVerifier)
      .then(confirmationResult => {
        window.confirmationResult = confirmationResult;
        document.getElementById('status').innerText = '!تم إرسال الكود';
      })
      .catch(error => {
        document.getElementById('status').innerText = 'خطأ: ' + error.message;
      });
  }

  function verifyOTP() {
    const code = document.getElementById('otpCode').value;
    window.confirmationResult.confirm(code)
      .then(result => {
        userPhone = result.user.phoneNumber;
        document.getElementById('login-section').style.display = 'none';
        document.getElementById('form-section').style.display = 'block';
        document.getElementById('orders-section').style.display = 'block';
      })
      .catch(error => {
        document.getElementById('status').innerText = '!رمز غير صحيح';
      });
  }

  const form = document.getElementById('requestForm');
  form.addEventListener('submit', e => {
    e.preventDefault();
    const formData = new FormData(form);
    formData.append('phone', userPhone);
    fetch(scriptURL, { method: 'POST', body: formData })
      .then(response => {
        document.getElementById('form-status').innerText = '!تم إرسال الطلب بنجاح';
        form.reset();
      })
      .catch(error => {
        document.getElementById('form-status').innerText = '!حدث خطأ أثناء الإرسال';
      });
  });

  function loadOrders() {
    fetch(`${scriptURL}?phone=${encodeURIComponent(userPhone)}`)
      .then(response => response.json())
      .then(data => {
        const listDiv = document.getElementById('orders-list');
        if (data.length === 0) {
          listDiv.innerHTML = "<p>لا توجد طلبات مرتبطة بهذا الرقم</p>";
        } else {
          listDiv.innerHTML = "";
          data.forEach(order => {
            const div = document.createElement('div');
            div.innerHTML = `
              <strong>:الموقع</strong> ${order.location}<br>
              <strong>:النوع</strong> ${order.propertyType}<br>
              <strong>:السعر</strong> ${order.priceMin} - ${order.priceMax}<br>
              <strong>:المساحة</strong> ${order.size} م²<br>
              <strong>:التاريخ </strong> ${order.date}
            `;
            listDiv.appendChild(div);
          });
        }
      })
      .catch(error => {
        document.getElementById('orders-list').innerHTML = "<p>.حدث خطأ أثناء جلب الطلبات</p>";
      });
  }
</script>
</body>
</html>



